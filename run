#/bin/bash

set -x

SERVICES=$*
if [[ -n "$SERVICES" ]]; then
  echo "building services: $SERVICES"
  SERVICES="-b $SERVICES" # developer regalions
  echo "building services: $SERVICES"
fi

if [[ -z "$HONEYCOMB_API_KEY" ]]; then
  echo "please set HONEYCOMB_API_KEY, it's required"
  exit 1
fi

# make sure we're logged in to the damn image repository
# TODO: the list succeeds just fine if we're not logged in. f u chatgpt
# the list check takes 1s; logging in takes like 6
scripts/login-acr.sh

# set -x

# maybe someday the container registry name will change, but this is what it is now
skaffold run -d mainacra1e0ec0b.azurecr.io $SERVICES --port-forward=user -l skaffold.dev/run-id=static
